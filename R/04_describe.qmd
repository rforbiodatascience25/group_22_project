---
title: "04_describe"
format: html
---

# Data description

In this document we go over the SIDER and Drugbank datasets to get an overview of how it looks.

```{r}
library(tidyverse)
#| message: false
#| warning: false
results_path <- "../results/"
df <- read_tsv("../data/merged_data.tsv") |>
  mutate(
    uniprot_names = str_split(uniprot_names, ";")
  )
# Count the most common side effects
common_side_effects <- df |>
  count(side_effect_PT, sort = TRUE)

# Which drugs has the most reported side effects
top_drugs_by_toxicity <- df |>
  count(common_name, sort = TRUE)

# View results
head(df)
head(common_side_effects)
head(top_drugs_by_toxicity)
```

For the merged dataframe of Drugbank and SIDER we have the following central values:

-   DrugBank ID: denominates the drug

-   Common name: is the name that the drug goes by

-   Drug Groups: whether the drug was approved, not approved, withdrawn etc

-   SMILES: A string that determines the chemical structure of the molecule

-   Formula: determines the chemical formula of the drug

-   UniProt Names: determines the name of the biological receptors targeted

-   HBD (Hydrogen Bond Donors): the number of hydrogen atoms in the molecule that can donate a hydrogen bond (typically –OH and –NH groups).

-   HBA (Hydrogen Bond Acceptors): the number of atoms in the molecule that can accept a hydrogen bond (typically O, N, S atoms with lone pairs).

-   Clog P: the calculated logarithm of the partition coefficient (P) between octanol and water; a measure of the compound’s lipophilicity.

-   Lipinski: whether the molecule follows Lipinski’s Rule of Five (only 4 rules though) (MW ≤ 500, Clog P ≤ 5, HBD ≤ 5, HBA ≤ 10), indicating good likelihood of oral bioavailability.

-   side_effect_PT: what side effects are listed with a certain drug

-   Freq_text: what different frequencies were reported with a certain side effect, if any

-   Freq_lower: lower bound freq

-   Freq_higher: upper bound freq

-   Indication_PT: In natural language what disease or symptom is targeted with the drug

```{r}
print(mean(common_side_effects$n))
print(quantile(common_side_effects$n))
print(length(unique(common_side_effects$side_effect_PT)))
```

A quick check determines that the average side effect is listed 28.5 times but the median side effect is reported 4 times, meaning side effects are very top heavy. We also see that we have 3831 total different listed side effects. This means most side effects are quite rare and few side effects are very common.

```{r}
print(mean(top_drugs_by_toxicity$n))
print(quantile(top_drugs_by_toxicity$n))
print(length(unique(top_drugs_by_toxicity$common_name)))
```

We see a similar trend in the distribution of how many side effects are associated with each drug.

```{r}
# Side effect frequency 
side_effect_counts <- df |> 
  group_by(side_effect_PT) |> 
  summarise(count = n(), .groups = "drop")

# Drug side effect count
drug_side_effect_counts <- df |> 
  group_by(common_name) |> 
  summarise(count = n(), .groups = "drop")

# Combine for plotting
combined_data <- bind_rows(
  side_effect_counts |>  mutate(category = "Side Effects\n(frequency across drugs)"),
  drug_side_effect_counts |>  mutate(category = "Drugs\n(number of side effects)")
)

# Violin plot
violin_plot <- ggplot(combined_data, aes(x = category, y = count, fill = category)) +
  geom_violin(alpha = 0.7) +
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  scale_y_log10() +
  labs(
    title = "Violin Plot: Distribution Shapes",
    x = "",
    y = "Count (log scale)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

ggsave(paste0(results_path,"Description_violin_plot.png"), plot = last_plot(), 
       width = 8, height = 6, dpi = 300)
print(violin_plot)
```

We see a distribution that is centered about the average value for the number of side effects per drug, while the side effects distribution is much more skewed. Drugs have a lot of side effects, but side effects are often specific although with a small amount of side effects being experienced in a large amount of drugs, side effects such as nausea, headache, stomach ache etc. Drugs with many side effects include pregabalin and testosterone.
