.groups = "drop"
)
# Compute and print the correlation
correlation <- cor(side_effect_rates$n_reports, side_effect_rates$avg_rate, use = "complete.obs")
print(paste("Correlation between number of reports and average frequency rate:", round(correlation, 3)))
# Plot
plot_correlation <- side_effect_rates |>
ggplot(aes(x = n_reports, y = avg_rate)) +
geom_point(alpha = 0.5, color = "darkcyan") +
geom_smooth(method = "lm", color = "red") +
labs(
title = "Correlation: Number of Reports vs. Frequency Rate",
subtitle = paste("Correlation coefficient:", round(correlation, 3)),
x = "Number of Reports (Drug-Side Effect Pairs)",
y = "Average Frequency Rate (%)"
) +
theme_minimal()
ggsave(paste0(results_path,"Analysis1_reports_vs_freq.png"), plot = last_plot(),
width = 8, height = 6, dpi = 300)
print(plot_correlation)
plot_matrix_normalized_data <- df %>%
# Extract % values like "0.5%; 3%; 10%"
mutate(percent = str_split(freq_text, "\\s*;\\s*")) %>%
unnest(percent) %>%
mutate(percent = readr::parse_number(percent)) %>%
drop_na(percent) %>%
# Expand multiple indications
separate_rows(indication_PT, sep = ";\\s*") %>%
# Filter to top items
filter(indication_PT %in% top_indications,
side_effect_PT %in% top_side_effects) %>%
# Summaries
group_by(indication_PT, side_effect_PT) %>%
summarise(
avg_rate = mean(percent),
n_percentage_mentions = n(),
n_drugs_contributing = n_distinct(drugbank_id),
.groups = "drop"
)
#| message: false
#| warning: false
library(tidyverse)
source("99_proj_func.R")
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
side_effect_rates <- df |>
# Split into individual percentages
mutate(percent = str_split(freq_text, "\\s*;\\s*")) |>
unnest(percent) |>
mutate(percent = readr::parse_number(percent)) |>
drop_na(percent) |>
group_by(side_effect_PT) |>
#create the stats needed for future plots
summarise(
avg_rate  = mean(percent),
median_rate = median(percent),
n_reports = n_distinct(drugbank_id),
n_percentage_mentions = n(),
.groups = "drop"
)
side_effect_rates |> arrange(desc(n_reports))
# Compute and print the correlation
correlation <- cor(side_effect_rates$n_reports, side_effect_rates$avg_rate, use = "complete.obs")
print(paste("Correlation between number of reports and average frequency rate:", round(correlation, 3)))
# Plot
plot_correlation <- side_effect_rates |>
ggplot(aes(x = n_reports, y = avg_rate)) +
geom_point(alpha = 0.5, color = "darkcyan") +
geom_smooth(method = "lm", color = "red") +
labs(
title = "Correlation: Number of Reports vs. Frequency Rate",
subtitle = paste("Correlation coefficient:", round(correlation, 3)),
x = "Number of Reports (Drug + Side Effect Pairs)",
y = "Average Frequency Rate (%)"
) +
theme_minimal()
ggsave(paste0(results_path,"Analysis1_reports_vs_freq.png"), plot = last_plot(),
width = 8, height = 6, dpi = 300)
print(plot_correlation)
# We only filter for the top 20 indications and top 20 side effects to make this viewable
#top 20 treatment targets
top_indications <- df |>
separate_rows(indication_PT, sep = ";\\s*") |>
count(indication_PT, sort = TRUE) |>
head(20) |>
pull(indication_PT)
#top 20 side effects overall
top_side_effects <- df |>
count(side_effect_PT, sort = TRUE) |>
head(20) |>
pull(side_effect_PT)
#co-occurence plot
plot_matrix <- df |>
separate_rows(indication_PT, sep = ";\\s*") |>
filter(
indication_PT %in% top_indications,
side_effect_PT %in% top_side_effects
) |>
count(indication_PT, side_effect_PT) |>
ggplot(aes(x = side_effect_PT, y = indication_PT, fill = n)) +
geom_tile() +
scale_fill_viridis_c(name = "Co-occurences") +
labs(
title = "Co-occurrences: Top Indications vs. Side Effects",
x = "Side Effect",
y = "Indication"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggsave(paste0(results_path,"Analysis1_co_occ_indic.png"), plot = last_plot(),
width = 8, height = 6, dpi = 300)
print(plot_matrix)
plot_matrix_normalized_data <- df %>%
# Extract % values like "0.5%; 3%; 10%"
mutate(percent = str_split(freq_text, "\\s*;\\s*")) %>%
unnest(percent) %>%
mutate(percent = readr::parse_number(percent)) %>%
drop_na(percent) %>%
# Expand multiple indications
separate_rows(indication_PT, sep = ";\\s*") %>%
# Filter to top items
filter(indication_PT %in% top_indications,
side_effect_PT %in% top_side_effects) %>%
# Summaries
group_by(indication_PT, side_effect_PT) %>%
summarise(
avg_rate = mean(percent),
n_percentage_mentions = n(),
n_drugs_contributing = n_distinct(drugbank_id),
.groups = "drop"
)
plot_matrix_normalized <- plot_matrix_normalized_data |>
ggplot(aes(x = side_effect_PT, y = indication_PT, fill = avg_rate)) +
geom_tile() +
scale_fill_viridis_c(name = "Avg. Frequency(%)") +
labs(
title = "Co-frequencies: Top Indications vs. Side Effects",
x = "Side Effect",
y = "Indication"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)
)
ggsave(paste0(results_path,"Analysis1_co_occ_indic_freq.png"), plot = last_plot(),
width = 8, height = 6, dpi = 300)
# show plot
plot_matrix_normalized
# Get top targets and side effects
top_targets <- df |>
mutate(uniprot_first = str_extract(uniprot_names, "^[^;]+")) |>
count(uniprot_first, sort = TRUE) |>
head(20) |>
pull(uniprot_first)
top_side_effects <- df |>
count(side_effect_PT, sort = TRUE) |>
head(20) |>
pull(side_effect_PT)
# Plot heatmap
plot_targets_se <- df |>
mutate(uniprot_first = str_extract(uniprot_names, "^[^;]+")) |>
filter(
uniprot_first %in% top_targets,
side_effect_PT %in% top_side_effects
) |>
count(uniprot_first, side_effect_PT) |>
mutate(uniprot_first = str_trunc(uniprot_first, 30)) |>
ggplot(aes(x = side_effect_PT, y = uniprot_first, fill = n)) +
geom_tile() +
scale_fill_viridis_c(name = "Co-occurrences") +
labs(
title = "Co-occurrences: Protein Targets vs. Side Effects",
x = "Side Effect",
y = "Protein Target"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggsave(paste0(results_path,"Analysis1_co_occ_targets.png"), plot = last_plot(),
width = 8, height = 6, dpi = 300)
print(plot_targets_se)
# plot biological targets vs side effects
# Calculate per-drug metrics
drug_targets_se <- df |>
group_by(drugbank_id, common_name) |>
summarise(
# Count unique targets
n_targets = n_distinct(unlist(str_split(uniprot_names, ";\\s*"))),
# Count unique side effects
n_side_effects = n_distinct(side_effect_PT),
.groups = "drop"
) |>
filter(!is.na(n_targets), n_targets > 0)
# Compute correlation
cor_targets <- cor(drug_targets_se$n_targets, drug_targets_se$n_side_effects,
use = "complete.obs")
#
plot_targets_vs_se <- drug_targets_se |>
ggplot(aes(x = n_targets, y = n_side_effects)) +
geom_point(alpha = 0.4, color = "steelblue") +
geom_smooth(method = "lm", color = "red", se = TRUE) +
labs(
title = "Number of Biological Targets vs. Number of Side Effects",
subtitle = paste("Correlation:", round(cor_targets, 3)),
x = "Number of Protein Targets",
y = "Number of Unique Side Effects"
) +
theme_minimal()
ggsave(paste0(results_path,"Analysis1_targets_se_correl.png"), plot = last_plot(),
width = 8, height = 6, dpi = 300)
print(plot_targets_vs_se)
# plot indications vs side effects
drug_indications_se <- df |>
group_by(drugbank_id, common_name) |>
summarise(
# Count unique indications
n_indications = n_distinct(unlist(str_split(indication_PT, ";\\s*"))),
# Count unique side effects
n_side_effects = n_distinct(side_effect_PT),
.groups = "drop"
) |>
filter(!is.na(n_indications), n_indications > 0)
# Compute correlation
cor_indications <- cor(drug_indications_se$n_indications, drug_indications_se$n_side_effects,
use = "complete.obs")
# Plot
plot_indications_vs_se <- drug_indications_se |>
ggplot(aes(x = n_indications, y = n_side_effects)) +
geom_point(alpha = 0.4, color = "darkgreen") +
geom_smooth(method = "lm", color = "red", se = TRUE) +
labs(
title = "Indications vs. Side Effects",
subtitle = paste("Correlation:", round(cor_indications, 3)),
x = "Number of Indications",
y = "Number of Unique Side Effects"
) +
theme_minimal()
ggsave(paste0(results_path,"Analysis1_indications_se_correl.png"), plot = last_plot(),
width = 8, height = 6, dpi = 300)
print(plot_indications_vs_se)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df <- df |>
# Extract % values like "0.5%; 3%; 10%"
mutate(percent = str_split(freq_text, "\\s*;\\s*")) |>
unnest(percent) |>
mutate(percent = readr::parse_number(percent)) |>
drop_na(percent)
df
View(df)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df <- df |>
# Extract % values like "0.5%; 3%; 10%"
mutate(percent = str_split(freq_text, "\\s*;\\s*")) |>
unnest(percent) |>
mutate(percent = readr::parse_number(percent))
df
View(df)
View(df)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
side_effect_rates <- df |>
# Split into individual percentages
mutate(percent = str_split(freq_text, "\\s*;\\s*")) |>
unnest(percent) |>
mutate(percent = readr::parse_number(percent)) |>
drop_na(percent) |>
group_by(side_effect_PT) |>
#create the stats needed for future plots
summarise(
avg_rate  = mean(percent),
median_rate = median(percent),
n_reports = n_distinct(drugbank_id),
n_percentage_mentions = n(),
.groups = "drop"
)
View(side_effect_rates)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df <- df |>
# Extract % values like "0.5%; 3%; 10%"
mutate(percent = str_split(freq_text, "\\s*;\\s*")) |>
unnest(percent) |>
mutate(percent = readr::parse_number(percent))
df
View(df)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df_fixed <- df %>%
# split the semicolon-separated field into multiple rows
# replace `freq_text` with your actual column name if different
separate_rows(freq_text, sep = ";") %>%
# remove surrounding whitespace left by the separators
mutate(freq_text = str_trim(freq_text)) %>%
# parse numeric part (e.g. "0.65%" -> 0.65). If you want proportion (0.0065)
# divide by 100.
mutate(percent = readr::parse_number(freq_text),
percent_prop = percent / 100)
# inspect result
df_fixed
View(df_fixed)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df_fixed <- df %>%
separate_rows(freq_text, sep = ";") %>%
mutate(freq_text = str_trim(freq_text)) %>%
mutate(percent = readr::parse_number(freq_text),
percent_prop = percent / 100)
# inspect result
df_fixed
View(df)
View(df_fixed)
View(df)
View(df_fixed)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df2 <- df %>%
mutate(percent = str_split(freq_text, "\\s*;\\s*")) %>%
unnest_longer(percent) %>%      # use unnest_longer to expand the list-column safely
mutate(percent = str_trim(percent),
percent = readr::parse_number(percent))
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df_fixed <- df %>%
mutate(
percent = str_extract_all(freq_text, "\\d+\\.?\\d*") %>%  # extract all numbers
map(as.numeric)                                        # convert each to numeric
)
View(df_fixed)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df_fixed <- df %>%
mutate(
percent = str_split(freq_text, ";") %>%             # split by semicolon
map(~ str_trim(.x)) %>%                           # trim spaces
map(readr::parse_number)                          # extract numeric part of each
)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
df_fixed <- df %>%
mutate(
percent = str_split(freq_text, ";") %>%
map(~ str_trim(.x)) %>%
map(readr::parse_number)
)
results_path = "../results/"
df <- read_tsv("../data/merged_data.tsv")
side_effect_rates <- df |>
# Split into individual percentages
mutate(percent = str_split(freq_text, "\\s*;\\s*")) |>
unnest(percent) |>
mutate(percent = readr::parse_number(percent)) |>
drop_na(percent) |>
group_by(side_effect_PT) |>
#create the stats needed for future plots
summarise(
avg_rate  = mean(percent),
median_rate = median(percent),
n_reports = n_distinct(drugbank_id),
n_percentage_mentions = n(),
.groups = "drop"
)
#| warning: false
#| error: false
#| message: true
#| output_dir: "../R/"
library(quarto)
library(knitr)
source("99_proj_func.R")
results_path <-  "../results/"
r_path <-  "../R/"
#Long runtime, 20-30 minutes
knit(paste0(r_path,"01_load.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"02_clean.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"03_augment.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"04_describe.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"05_analysis.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"06_analysis_2.qmd"), output = tempfile(fileext = ".md"))
quarto_render(input = paste0(r_path, "01_load.qmd"),
quarto_args = c("--output-dir", results_path))
usethis::create_github_token()
install.packages("usethis")
usethis::create_github_token()
gitcreds::gitcreds_set()
system('git config --global user.name "adunavolgyi")
system('git config --global user.name "adunavolgyi"')
system('git config --global user.email "s243161@dtu.dk"')
quarto_render(input = paste0(r_path, "00_all.qmd"),
quarto_args = c("--output-dir", results_path))
#| warning: false
#| error: false
#| message: true
#| output_dir: "../R/"
library(quarto)
quarto_render(input = paste0(r_path, "00_all.qmd"),
quarto_args = c("--output-dir", results_path))
#| message: false
library(tidyverse)
source("99_proj_func.R")
#| message: false
#| warning: false
data_path = "../data/"
results_path = "../results/"
df <- read_tsv(paste0(data_path, "merged_data.tsv"))
df_drug <- df |>
group_by(drugbank_id) |>
summarise(
common_name = first(common_name),
drug_groups = first(drug_groups),
smiles = first(smiles),
formula = first(formula),
uniprot_names = first(uniprot_names),
molecular_weight = first(molecular_weight),
hbd = first(hbd),
hba = first(hba),
clog_p = first(clog_p),
lipinski = first(lipinski),
# side effects
side_effects = str_c(unique(side_effect_PT), collapse = "; "),
side_effect_burden = n_distinct(side_effect_PT),
.groups = "drop"
)
#Long runtime, 20-30 minutes
knit(paste0(r_path,"01_load.qmd"), output = tempfile(fileext = ".md"))
#| warning: false
#| error: false
#| message: true
#| output_dir: "../R/"
library(quarto)
library(knitr)
source("99_proj_func.R")
results_path <-  "../results/"
r_path <-  "../R/"
#Long runtime, 20-30 minutes
knit(paste0(r_path,"01_load.qmd"), output = tempfile(fileext = ".md"))
#Long runtime, 20-30 minutes
knit(paste0(r_path,"01_load.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"02_clean.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"03_augment.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"04_describe.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"05_analysis.qmd"), output = tempfile(fileext = ".md"))
knit(paste0(r_path,"06_analysis.qmd"), output = tempfile(fileext = ".md"))
#| message: false
library(tidyverse)
source("99_proj_func.R")
#| message: false
#| warning: false
data_path = "../data/"
results_path = "../results/"
df <- read_tsv(paste0(data_path, "merged_data.tsv"))
df_drug <- df |>
group_by(drugbank_id) |>
summarise(
common_name = first(common_name),
drug_groups = first(drug_groups),
smiles = first(smiles),
formula = first(formula),
uniprot_names = first(uniprot_names),
molecular_weight = first(molecular_weight),
hbd = first(hbd),
hba = first(hba),
clog_p = first(clog_p),
lipinski = first(lipinski),
# side effects
side_effects = str_c(unique(side_effect_PT), collapse = "; "),
side_effect_burden = n_distinct(side_effect_PT),
.groups = "drop"
)
#| message: false
#| warning: false
data_path = "../data/"
results_path = "../results/"
df <- read_tsv(paste0(data_path, "merged_data.tsv"))
df_drug <- df |>
group_by(drugbank_id) |>
summarise(
common_name = first(common_name),
drug_groups = first(drug_groups),
smiles = first(smiles),
formula = first(formula),
uniprot_names = first(uniprot_names),
molecular_weight = first(molecular_weight),
hbd = first(hbd),
hba = first(hba),
clog_p = first(clog_p),
lipinski = first(lipinski),
# side effects
side_effects = str_c(unique(side_effect_PT), collapse = "; "),
side_effect_burden = n_distinct(side_effect_PT),
.groups = "drop"
)
View(df)
#| message: false
library(tidyverse)
library(dplyr)
library(stringr)
library(rcdk)
install.packages("rJava")
#| message: false
library(tidyverse)
library(dplyr)
library(stringr)
library(rcdk)
install.packages("rJava")
library(rJava)
#| message: false
library(tidyverse)
library(dplyr)
library(stringr)
library(rJava)
